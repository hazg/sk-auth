{"version":3,"file":"twitter.js","sources":["../../src/providers/twitter.ts"],"sourcesContent":["import { OAuth2BaseProvider } from \"./oauth2.base\";\nconst defaultConfig = {\n    id: \"twitter\",\n};\nexport class TwitterAuthProvider extends OAuth2BaseProvider {\n    constructor(config) {\n        super({\n            ...defaultConfig,\n            ...config,\n        });\n    }\n    async getRequestToken(auth, host) {\n        const endpoint = \"https://api.twitter.com/oauth/request_token\";\n        const data = {\n            oauth_callback: encodeURIComponent(this.getCallbackUri(auth, host)),\n            oauth_consumer_key: this.config.apiKey,\n        };\n        const res = await fetch(`${endpoint}?${new URLSearchParams(data)}`, { method: \"POST\" });\n        const { oauth_token, oauth_token_secret, oauth_callback_confirmed } = await res.json();\n        return {\n            oauthToken: oauth_token,\n            oauthTokenSecret: oauth_token_secret,\n            oauthCallbackConfirmed: oauth_callback_confirmed,\n        };\n    }\n    async getAuthorizationUrl({ url }, auth, state, nonce) {\n        const endpoint = \"https://api.twitter.com/oauth/authorize\";\n        const { oauthToken } = await this.getRequestToken(auth, url.host);\n        const data = {\n            oauth_token: oauthToken,\n        };\n        const authUrl = `${endpoint}?${new URLSearchParams(data)}`;\n        return authUrl;\n    }\n    async getTokens(oauthToken, oauthVerifier) {\n        const endpoint = \"https://api.twitter.com/oauth/access_token\";\n        const data = {\n            oauth_consumer_key: this.config.apiKey,\n            oauth_token: oauthToken,\n            oauth_verifier: oauthVerifier,\n        };\n        const res = await fetch(`${endpoint}?${new URLSearchParams(data)}`, { method: \"POST\" });\n        return await res.json();\n    }\n    async getUserProfile({ oauth_token, oauth_token_secret: _ }) {\n        const endpoint = \"https://api.twitter.com/1.1/account/verify_credentials.json\";\n        const res = await fetch(endpoint, { headers: { Authorization: `Bearer ${oauth_token}` } });\n        return await res.json();\n    }\n    async callback({ url }, auth) {\n        const oauthToken = url.searchParams.get(\"oauth_token\");\n        const oauthVerifier = url.searchParams.get(\"oauth_verifier\");\n        const redirect = this.getStateValue(url.searchParams, \"redirect\");\n        const tokens = await this.getTokens(oauthToken, oauthVerifier);\n        let user = await this.getUserProfile(tokens);\n        if (this.config.profile) {\n            user = await this.config.profile(user, tokens);\n        }\n        return [user, redirect ?? this.getUri(auth, \"/\", url.host)];\n    }\n}\n"],"names":[],"mappings":"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"}