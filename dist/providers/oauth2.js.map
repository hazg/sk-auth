{"version":3,"file":"oauth2.js","sources":["../../src/providers/oauth2.ts"],"sourcesContent":["import { ucFirst } from \"../helpers\";\nimport { OAuth2BaseProvider } from \"./oauth2.base\";\nconst defaultConfig = {\n    responseType: \"code\",\n    grantType: \"authorization_code\",\n    contentType: \"application/json\",\n};\nexport class OAuth2Provider extends OAuth2BaseProvider {\n    constructor(config) {\n        super({\n            ...defaultConfig,\n            ...config,\n        });\n    }\n    getAuthorizationUrl({ url }, auth, state, nonce) {\n        const data = {\n            state,\n            nonce,\n            response_type: this.config.responseType,\n            client_id: this.config.clientId,\n            scope: Array.isArray(this.config.scope) ? this.config.scope.join(\" \") : this.config.scope,\n            redirect_uri: this.getCallbackUri(auth, url.host),\n            ...(this.config.authorizationParams ?? {}),\n        };\n        const authUrl = `${this.config.authorizationUrl}?${new URLSearchParams(data)}`;\n        return authUrl;\n    }\n    async getTokens(code, redirectUri) {\n        const data = {\n            code,\n            grant_type: this.config.grantType,\n            client_id: this.config.clientId,\n            redirect_uri: redirectUri,\n            client_secret: this.config.clientSecret,\n            ...(this.config.params ?? {}),\n        };\n        let body;\n        if (this.config.contentType === \"application/x-www-form-urlencoded\") {\n            body = Object.entries(data)\n                .map(([key, value]) => `${encodeURIComponent(key)}=${encodeURIComponent(value)}`)\n                .join(\"&\");\n        }\n        else {\n            body = JSON.stringify(data);\n        }\n        const res = await fetch(this.config.accessTokenUrl, {\n            body,\n            method: \"POST\",\n            headers: {\n                \"Content-Type\": this.config.contentType,\n                ...(this.config.headers ?? {}),\n            },\n        });\n        return await res.json();\n    }\n    async getUserProfile(tokens) {\n        const res = await fetch(this.config.profileUrl, {\n            headers: { Authorization: `${ucFirst(tokens.token_type)} ${tokens.access_token}` },\n        });\n        return await res.json();\n    }\n}\n"],"names":[],"mappings":"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"}